name: build release binaries

on: 
  push:
  pull_request:

env:
  REGISTRY: ghcr.io
jobs:
  release-build:
    runs-on: ubuntu-latest
    container: ghcr.io/lingo-db/lingodb-py-dev:c6088f9e5624fcfea2dc50c1137b45ea721bf6e7
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Build
        run: |
            mkdir build
            cmake -G Ninja . -B build -DCMAKE_BUILD_TYPE=Release -DClang_DIR=/built-llvm/lib/cmake/clang -DArrow_DIR=/built-arrow/lib64/cmake/Arrow
            cmake --build build --target sql
      - uses: actions/upload-artifact@master
        with:
          name: lingodb-release-build
          path: build/sql